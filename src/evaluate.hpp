#pragma once

#include "./board.hpp"

namespace Chess {

static int count_material(const Board &b) {
  using namespace Chess;
  // { WN, WB, WR, WQ, WK, WP, BN, BB, BR, BQ, BK, BP }
  static constexpr int piece_value[12] = {30, 30, 50, 90, 0, 10, -30, -30, -50, -90, 0, -10};
  int res                              = 0;
  for (Square sq = A1; sq <= H8; ++sq) {
    auto i = b.get_pieceBB_index(sq);
    res += i == invalid_index ? 0 : piece_value[i];
  }
  return res;
}

static int piece_square(const Board &b) {
  // clang-format off
  static constexpr int psq[6][64] = {
    // WN
    {-50,-40,-30,-30,-30,-30,-40,-50,
     -40,-20,  0,  0,  0,  0,-20,-40,
     -30,  0, 10, 15, 15, 10,  0,-30,
     -30,  5, 15, 20, 20, 15,  5,-30,
     -30,  0, 15, 20, 20, 15,  0,-30,
     -30,  5, 10, 15, 15, 10,  5,-30,
     -40,-20,  0,  5,  5,  0,-20,-40,
     -50,-40,-30,-30,-30,-30,-40,-50},

    // WB
    {-20,-10,-10,-10,-10,-10,-10,-20,
     -10,  0,  0,  0,  0,  0,  0,-10,
     -10,  0,  5, 10, 10,  5,  0,-10,
     -10,  5,  5, 10, 10,  5,  5,-10,
     -10,  0, 10, 10, 10, 10,  0,-10,
     -10, 10, 10, 10, 10, 10, 10,-10,
     -10,  5,  0,  0,  0,  0,  5,-10,
     -20,-10,-10,-10,-10,-10,-10,-20},

    // WR
    { 0, 0,  0,  0,  0,  0,  0,  0,
      5,10, 10, 10, 10, 10, 10,  5,
     -5, 0,  0,  0,  0,  0,  0, -5,
     -5, 0,  0,  0,  0,  0,  0, -5,
     -5, 0,  0,  0,  0,  0,  0, -5,
     -5, 0,  0,  0,  0,  0,  0, -5,
     -5, 0,  0,  0,  0,  0,  0, -5,
      0, 0,  0,  5,  5,  0,  0,  0},

    // WQ
    {-20,-10,-10, -5, -5,-10,-10,-20,
     -10,  0,  0,  0,  0,  0,  0,-10,
     -10,  0,  5,  5,  5,  5,  0,-10,
      -5,  0,  5,  5,  5,  5,  0, -5,
       0,  0,  5,  5,  5,  5,  0, -5,
     -10,  5,  5,  5,  5,  5,  0,-10,
     -10,  0,  5,  0,  0,  0,  0,-10,
     -20,-10,-10, -5, -5,-10,-10,-20},

    // WK
    {-30,-40,-40,-50,-50,-40,-40,-30,
     -30,-40,-40,-50,-50,-40,-40,-30,
     -30,-40,-40,-50,-50,-40,-40,-30,
     -30,-40,-40,-50,-50,-40,-40,-30,
     -20,-30,-30,-40,-40,-30,-30,-20,
     -10,-20,-20,-20,-20,-20,-20,-10,
      20, 20,  0,  0,  0,  0, 20, 20,
      20, 30, 10,  0,  0, 10, 30, 20},

    // WP
    {0,  0,  0,  0,  0,  0,  0,  0,
     50, 50, 50, 50, 50, 50, 50, 50,
     10, 10, 20, 30, 30, 20, 10, 10,
     5,  5, 10, 25, 25, 10,  5,  5,
     0,  0,  0, 20, 20,  0,  0,  0,
     5, -5,-10,  0,  0,-10, -5,  5,
     5, 10, 10,-20,-20, 10, 10,  5,
     0,  0,  0,  0,  0,  0,  0,  0}
  };
  // clang-format on
  int res = 0;
  for (Square sq = A1; sq <= H8; ++sq) {
    auto i        = b.get_pieceBB_index(sq);
    auto is_black = i >= 6;
    auto sq_      = is_black ? sq ^ 56 : sq;
    res += i == invalid_index ? 0 : psq[is_black ? i - 6 : i][sq_] * (is_black ? -1 : 1);
  }
  return res;
}

inline int evaluate(const Board &b) { return count_material(b) + piece_square(b); }

}  // namespace Chess
